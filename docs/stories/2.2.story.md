---
id: story-2.2
title: "Story 2.2: Backend Filtering Logic"
---

### Status
- [ ] Draft
- [X] Approved
- [ ] In Progress
- [ ] Review
- [ ] Done

### Story
**As a** developer,
**I want** to enhance the backend service to accept filter parameters and apply them to the news data,
**so that** only relevant news is returned to the desktop application.

### Acceptance Criteria
1. The backend serverless function is updated to accept parameters for Market Cap, Float, and Price.
2. The backend service can recognize and include news related to a predefined list of major market-moving entities/keywords if the 'Include Major Market News' flag is enabled.
3. The service logic correctly filters the news data based on all received parameters.
4. If no parameters are provided, the full, unfiltered list of news is returned.

### Tasks / Subtasks
- [ ] **Task 1: Update Serverless Function** (AC: 1)
  - [ ] Modify the `GET /news` serverless function to accept query parameters for `marketCapMin`, `marketCapMax`, `floatMax`, `priceMin`, and `priceMax`.
- [ ] **Task 2: Implement Filtering Logic** (AC: 3)
  - [ ] In the `NewsRepository`, add a method to filter news based on the provided parameters.
  - [ ] The filtering should be done at the database level for efficiency.
- [ ] **Task 3: Implement Major Market News Logic** (AC: 2)
  - [ ] Create a predefined list of major market-moving entities/keywords.
  - [ ] Update the filtering logic to include news related to these entities/keywords when the `includeMajorMarketNews` flag is true.
- [ ] **Task 4: Handle No Parameters** (AC: 4)
  - [ ] Ensure that if no filter parameters are provided, the function returns the full, unfiltered list of news.
- [ ] **Task 5: Unit Tests**
  - [ ] Write unit tests for the filtering logic in the `NewsRepository`.
  - [ ] Write unit tests for the `GET /news` serverless function.

### Dev Notes
- **API Specification:** The `GET /news` endpoint should be updated to accept the new filter parameters. [Source: docs/architecture/5-api-specification.md]
- **Data Models:** The `FilterPreset` data model defines the structure of the filter parameters. [Source: docs/architecture/4-data-models.md]
- **Database Schema:** The `news` table will be queried to filter the news articles. [Source: docs/architecture/9-database-schema.md]
- **Backend Architecture:** The filtering logic should be implemented in the `NewsRepository` class. [Source: docs/architecture/11-backend-architecture.md]
- **Project Structure:** The serverless function is located in the `apps/api/src/news` directory. [Source: docs/architecture/12-unified-project-structure.md]

#### Testing
- **Testing Framework:** Use Vitest for unit tests. [Source: docs/architecture/16-testing-strategy.md]
- **Test File Location:** Test files should be located next to the source files. [Source: docs/architecture/16-testing-strategy.md]

### Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-08-08 | 1.0 | Initial draft | Bob |

### Dev Agent Record
#### Agent Model Used
{{agent_model_name_version}}
#### Debug Log References
-
#### Completion Notes List
-
#### File List
-

### QA Results
-
