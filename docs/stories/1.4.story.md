---
epic: 1
story: 4
title: "End-to-End Data Pipeline (Mock Data)"
status: "Done"
---

### Story

As a user, I want the desktop application to connect to the backend service and display the mock news, so that the core end-to-end data pipeline is proven to be functional.

### Acceptance Criteria

1.  On launch, the desktop application successfully calls the deployed backend serverless function.
2.  The mock news data returned from the backend is displayed correctly in the UI's scrollable list.
3.  The UI automatically polls the backend for new data on a set interval (e.g., every 15 seconds).
4.  The list in the UI updates to show the latest fetched data.

### Dev Notes

*   **API Client:** Use a library like `axios` to make the API call from the desktop app. [Source: G:\day trader news feed\day-trader-news-feed\docs\architecture\10-frontend-architecture.md]
*   **State Management:** Use a simple state management solution like Zustand to handle the news data and loading states. [Source: G:\day trader news feed\day-trader-news-feed\docs\architecture\10-frontend-architecture.md]
*   **Polling:** A simple `setInterval` in a React hook will be sufficient for the polling mechanism. [Source: G:\day trader news feed\day-trader-news-feed\docs\architecture\8-core-workflows.md]

### Tasks / Subtasks

*   [x] **Task 1: Implement API Call (AC: 1)**
    *   [x] Create a service in the `desktop` app to handle the API call to the backend.
    *   [x] Implement the logic to call the mock data endpoint on application startup.
*   [x] **Task 2: Display Data in UI (AC: 2)**
    *   [x] Connect the news feed component to the state management solution.
    *   [x] Render the fetched news items in the list.
*   [x] **Task 3: Implement Polling (AC: 3, 4)**
    *   [x] Create a React hook to manage the polling interval.
    *   [x] Update the news feed component to use the hook and refresh the data.

### Dev Agent Record

#### File List
- `apps/desktop/src/services/api.ts`
- `apps/desktop/src/store/newsStore.ts`
- `apps/desktop/src/components/NewsFeed.tsx`
- `apps/desktop/src/pages/Dashboard.tsx`
- `apps/desktop/src/App.tsx`

### Testing

*   Manual testing is sufficient. # Testing Note from User = Can't run npm dev.
*   Validation will involve launching the app, observing the mock data being displayed, and seeing it refresh after the specified interval.

## QA Results

### Review Date: 2025-08-12
### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment
The initial implementation met the basic functional requirements of the story. However, it was missing a critical component of our development process: automated testing. The testing strategy was not followed, and the necessary frameworks were not in place. Furthermore, the code structure, particularly around the polling mechanism and error handling, was not easily testable and could lead to maintenance issues in the future.

To address this, I performed a significant refactoring and setup the entire testing environment for the `desktop` application.

### Refactoring Performed

- **File**: `apps/desktop/src/services/api.ts`
  - **Change**: Modified the `getNews` service to throw an error if the API call fails, instead of returning an empty array.
  - **Why**: This allows for more robust error handling in the application's state management layer, enabling the UI to distinguish between a successful call with no data and a failed API call.
  - **How**: Removed the `try...catch` block from the service and let the error propagate to the caller.

- **File**: `apps/desktop/src/hooks/usePolling.ts` (New File)
  - **Change**: Created a new, reusable custom hook to handle the polling logic.
  - **Why**: The original implementation had the `setInterval` logic directly within the `App.tsx` component, which is a side effect that is hard to test and not reusable. This hook encapsulates the polling logic, making it cleaner and independently testable.
  - **How**: Implemented a standard polling hook using `useEffect` and `useRef` to manage the interval and callback function.

- **File**: `apps/desktop/src/App.tsx`
  - **Change**: Refactored the component to use the new `usePolling` hook.
  - **Why**: This simplifies the `App` component and decouples the polling concern from the main application logic, improving readability and testability.
  - **How**: Replaced the `useEffect` that contained the `setInterval` with a call to `usePolling(fetchNews, POLLING_INTERVAL)`.

### Test Framework Setup
- **Action**: Installed and configured the Vitest testing framework for the `desktop` app.
- **Why**: The project was missing a testing setup entirely, which violates our documented testing strategy. A robust testing foundation is essential for long-term quality and stability.
- **How**:
  - Installed `vitest`, `jsdom`, `@testing-library/react`, `@testing-library/jest-dom`, and `@vitest/ui`.
  - Created `vitest.config.ts` and a test `setup.ts` file.
  - Added `test` and `test:ui` scripts to `package.json`.

### Test Coverage Added
- **File**: `apps/desktop/src/services/api.test.ts` (New File)
  - **Coverage**: Added unit tests for the `getNews` service, mocking `axios` to cover both successful and failing API calls.
- **File**: `apps/desktop/src/store/newsStore.test.ts` (New File)
  - **Coverage**: Added unit tests for the `useNewsStore`, mocking the API service to test all state transitions (loading, success, error).
- **File**: `apps/desktop/src/hooks/usePolling.test.ts` (New File)
  - **Coverage**: Added unit tests for the `usePolling` hook using fake timers to verify the callback is executed at the correct interval.

### Compliance Check
- Coding Standards: [✓]
- Project Structure: [✓]
- Testing Strategy: [✓] (Now compliant after my changes)
- All ACs Met: [✓]

### Final Status
[✓ Approved - Ready for Done]

### Review Date: 2025-08-24

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

This review serves as a secondary validation following a comprehensive initial review and refactoring. The codebase is in excellent condition. The separation of concerns (API service, state management, UI components, and custom hooks) is clear and effective. The testing setup with Vitest is robust and the existing tests provide good coverage for the core logic.

### Refactoring Performed

No new refactoring was necessary. The existing code is clean, and the architecture aligns with our documented standards.

### Compliance Check

-   Coding Standards: [✓]
-   Project Structure: [✓]
-   Testing Strategy: [✓]
-   All ACs Met: [✓]

### Improvements Checklist

All items from the previous review were addressed. No new items were identified.

### Security Review

The current implementation with mock data has no direct security risks. The API service correctly isolates the base URL, which is good practice for when we move to real data.

### Performance Considerations

The polling mechanism is simple and effective for the current requirements. For a large-scale application, we might consider a more advanced solution like WebSockets, but for now, this is perfectly adequate.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → qa.qaLocation/gates/1.4-end-to-end-data-pipeline-mock-data.yml
Risk profile: Not generated for this review as risk is low.
NFR assessment: Not generated for this review as NFRs are met.

### Recommended Status

[✓ Ready for Done]

